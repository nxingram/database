# SUBQUERY
    # select * from (select * from table) 
    select cognome, stipendio from impiegato 
    where stipendio > 
    (select stipendio from impiegato where id=6)
    order by cognome;


    SELECT e.nome, l.titolo
    FROM editore e, libro l
    WHERE e.id=l.editore_id 
    AND editore_id=(SELECT MAX(id) FROM editore);

### ALL, HAVING, NOT IN(<>ALL) p195
    SELECT u.nome,AVG(stipendio)
    FROM impiegato i, ufficio u
    WHERE u.id = i.ufficio_id
    GROUP BY i.ufficio_id
    HAVING AVG(stipendio) >= ALL ( SELECT AVG( stipendio ) FROM impiegato GROUP BY ufficio_id);


    SELECT cognome, nome, ufficio_id FROM impiegato
    WHERE ufficio_id = ANY (SELECT id FROM ufficio WHERE luogo_id = 20);

### IN, NOT IN
    SELECT nome,telefono,citta FROM cliente
    WHERE id IN (SELECT cliente_id FROM ordine);

    SELECT nome, telefono, citta FROM cliente
    WHERE id NOT IN (SELECT cliente_id FROM ordine);

### ROW( field1, field2 ) 
    SELECT nome, cognome FROM amico
    WHERE ROW(nome, cognome) = ( SELECT nome, cognome FROM parente WHERE id=11);

    SELECT nome, cognome FROM amico
    WHERE ROW(nome, cognome) = ('paola', 'bianchi');


### IF(expr1, expr2, expr3),...
    # Se expr1 è vera viene usata expr2, se expr1 è falsa viene usata expr3
    # SELECT IF ( 1 > 2 , 2 , 3 );->3
    # SELECT IF (1<2,'yes','no');->'yes'

    UPDATE articoloaSET a.rimanenza = IF(
    (SELECT SUM(quantita)FROM ordine_dettaglio od WHERE od.articolo_id=a.id GROUP BY a.id)>0,    
    100-(SELECT SUM(quantita)FROM ordine_dettaglio od WHERE od.articolo_id=a.id GROUP BY a.id),    
    100);

### CASE
    CASE value WHEN [compare_value]
    THEN result [WHEN [compare_value]
    THEN result …]
    [ELSE result] END
    CASE WHEN [condition]
    THEN result [WHEN [condition]
    THEN result ...][ELSE result] END

    SELECT
    provincia,
    CASE provincia
    WHEN 'to' THEN 'Torino'
    WHEN 'at' THEN 'Asti'
    WHEN 'no' THEN 'Novara'
    WHEN 'al' THEN 'Alessandria'
    WHEN 'cn' THEN 'Cuneo'
    ELSE 'Vercelli' END 'Provincia completa'
    FROM studenti;

    SELECT
    titolo,
    prezzo,
    CASE
    WHEN prezzo < 5 THEN 'economico'
    WHEN prezzo >= 5 AND prezzo <= 10 THEN 'medio'
    WHEN prezzo > 10 THEN 'caro'
    END valutazione
    FROM libri;

    SELECT
    cognome,
    CASE WHEN genere = 'f' THEN 'Donna' ELSE 'Uomo' END
    Genere
    from studenti;

# EXISTS o NOT EXISTS  
    # è una join....
    SELECT nome FROM editore e 
    WHERE EXISTS(SELECT editore_id FROM libro WHERE editore_id= e.id);

    # uguale a
    select distinct nome from editore e 
    join libro l where e.id=l.editore_id

    # not exists
    SELECT nome FROM editore e 
    WHERE NOT EXISTS(SELECT * FROM libro WHERE editore_id=e.id);

    # stessa cosa con una OUTER JOIN  
    SELECT nome FROM editore e
    LEFT JOIN libro l ON e.id=l.editore_id
    WHERE l.editore_id IS NULL;


## Subquery nella clausola FROM  
    SELECT tbl.cognome, MAX(tbl.quanti) FROM 
    (SELECT COUNT(cognome) AS quanti, cognome  
    FROM studente GROUP BY cognome ORDER BY quanti DESC ) 
    AS tbl;

























